{"version":3,"names":[],"mappings":"","sources":["main.min.js"],"sourcesContent":["!function e(t,n,o){function i(r,c){if(!n[r]){if(!t[r]){var u=\"function\"==typeof require&&require;if(!c&&u)return u(r,!0);if(s)return s(r,!0);var a=new Error(\"Cannot find module '\"+r+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){var n=t[r][1][e];return i(n?n:e)},l,l.exports,e,t,n,o)}return n[r].exports}for(var s=\"function\"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(e,t,n){(function(t){\"use strict\";var n=e(\"nes/client\"),o=window.location.protocol.indexOf(\"https\")===-1?\"ws\":\"wss\",i=new n.Client(o+\"://\"+window.location.host);i.connect(function(e){e&&console.log(\"WebSocket Error: \"+e)}),t.wsTest=function(e){var t={path:\"hello\",method:\"POST\",payload:{value:e}};i.request(t,function(e,t){alert(t)})};var s=function(e,t){alert(JSON.stringify(e,null,4))};t.wsSubscribe=function(e){i.subscribe(\"/item/\"+e,s,function(e){})},t.wsUnsubscribe=function(e){i.unsubscribe(\"/item/\"+e,s,function(e){})},t.wsSubscriptions=function(){var e=i.subscriptions();alert(e)},t.wsSendtoChannel=function(e,t){var n={path:\"subscribe\",method:\"POST\",payload:{message:t,channel:e}};i.request(n,function(e,t){alert(t)})},i.onUpdate=function(e){alert(e)},t.wsBroadcast=function(e){var t={path:\"broadcast\",method:\"POST\",payload:{message:e}};i.request(t,function(e,t){alert(t)})}}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"nes/client\":2}],2:[function(e,t,n){\"use strict\";t.exports=e(\"./dist/client\")},{\"./dist/client\":3}],3:[function(e,t,n){(function(e){\"use strict\";var o=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol?\"symbol\":typeof e};!function(e,i){\"object\"===(\"undefined\"==typeof n?\"undefined\":o(n))&&\"object\"===(\"undefined\"==typeof t?\"undefined\":o(t))?t.exports=i():\"function\"==typeof define&&define.amd?define(i):\"object\"===(\"undefined\"==typeof n?\"undefined\":o(n))?n.nes=i():e.nes=i()}(\"undefined\"!=typeof window?window:e,function(){var e=\"2\",t=function(){},n=function(e,t){var n=null,o=null;try{n=JSON.parse(e)}catch(e){o=new s(e,\"protocol\")}return t(o,n)},o=function(e,t){var n=null,o=null;try{n=JSON.stringify(e)}catch(e){o=new s(e,\"user\")}return t(o,n)},i=function(e){return function(t){setTimeout(function(){return e(t)},0)}},s=function(e,t){return\"string\"==typeof e&&(e=new Error(e)),e.type=t,e},r={1e3:\"Normal closure\",1001:\"Going away\",1002:\"Protocol error\",1003:\"Unsupported data\",1004:\"Reserved\",1005:\"No status received\",1006:\"Abnormal closure\",1007:\"Invalid frame payload data\",1008:\"Policy violation\",1009:\"Message too big\",1010:\"Mandatory extension\",1011:\"Internal server error\",1015:\"TLS handshake\"},c=function(e,n){n=n||{},this._url=e,this._settings=n,this._heartbeatTimeout=!1,this._ws=null,this._reconnection=null,this._reconnectionTimer=null,this._ids=0,this._requests={},this._subscriptions={},this._heartbeat=null,this._packets=[],this._disconnectListeners=null,this._disconnectRequested=!1,this.onError=function(e){return console.error(e)},this.onConnect=t,this.onDisconnect=t,this.onUpdate=t,this.id=null};return c.WebSocket=\"undefined\"==typeof WebSocket?null:WebSocket,c.prototype.connect=function(e,t){return\"function\"==typeof e&&(t=arguments[0],e={}),this._reconnection?i(t)(new Error(\"Cannot connect while client attempts to reconnect\")):this._ws?i(t)(new Error(\"Already connected\")):(e.reconnect!==!1?this._reconnection={wait:0,delay:e.delay||1e3,maxDelay:e.maxDelay||5e3,retries:e.retries||1/0,settings:{auth:e.auth,timeout:e.timeout}}:this._reconnection=null,void this._connect(e,!0,t))},c.prototype._connect=function(e,t,n){var o=this,i=new c.WebSocket(this._url,this._settings.ws);this._ws=i,clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null;var u=function(e){if(n){var t=n;return n=null,t(e)}return o.onError(e)},a=function(){if(o._cleanup(),u(new s(\"Connection timed out\",\"timeout\")),t)return o._reconnect()},l=e.timeout?setTimeout(a,e.timeout):null;i.onopen=function(){return clearTimeout(l),i.onopen=null,o._hello(e.auth,function(e){return e?(e.path&&delete o._subscriptions[e.path],o._disconnect(function(){return u(e)},!0)):(o.onConnect(),u())})},i.onerror=function(e){clearTimeout(l),o._cleanup();var t=new s(\"Socket error\",\"ws\");return u(t)},i.onclose=function(e){i.onopen&&u(new Error(\"Connection terminated while while to connect\"));var t=o._disconnectRequested;o._cleanup();var n={code:e.code,explanation:r[e.code]||\"Unknown\",reason:e.reason,wasClean:e.wasClean,willReconnect:!!(o._reconnection&&o._reconnection.retries>=1),wasRequested:t};o.onDisconnect(n.willReconnect,n),o._reconnect()},i.onmessage=function(e){return o._onMessage(e)}},c.prototype.overrideReconnectionAuth=function(e){return!!this._reconnection&&(this._reconnection.settings.auth=e,!0)},c.prototype.disconnect=function(e){return e=e||t,this._disconnect(e,!1)},c.prototype._disconnect=function(e,t){this._reconnection=null,clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null;var n=this._disconnectRequested||!t;return this._disconnectListeners?(this._disconnectRequested=n,void this._disconnectListeners.push(e)):!this._ws||this._ws.readyState!==c.WebSocket.OPEN&&this._ws.readyState!==c.WebSocket.CONNECTING?i(e)():(this._disconnectRequested=n,this._disconnectListeners=[e],void this._ws.close())},c.prototype._cleanup=function(){this._ws&&(this._ws.readyState!==c.WebSocket.OPEN&&this._ws.readyState!==c.WebSocket.CONNECTING||this._ws.close(),this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=t,this._ws.onmessage=null,this._ws=null),this._packets=[],this.id=null,clearTimeout(this._heartbeat),this._heartbeat=null;for(var e=new s(\"Request failed - server disconnected\",\"disconnect\"),n=Object.keys(this._requests),o=0;o<n.length;++o){var i=n[o],r=this._requests[i],u=r.callback;clearTimeout(r.timeout),delete this._requests[i],u(e)}if(this._disconnectListeners){var a=this._disconnectListeners;this._disconnectListeners=null,this._disconnectRequested=!1,a.forEach(function(e){return e()})}},c.prototype._reconnect=function(){var e=this;if(this._reconnection){if(this._reconnection.retries<1)return this._disconnect(t,!0);--this._reconnection.retries,this._reconnection.wait=this._reconnection.wait+this._reconnection.delay;var n=Math.min(this._reconnection.wait,this._reconnection.maxDelay);this._reconnectionTimer=setTimeout(function(){e._connect(e._reconnection.settings,!1,function(t){if(t)return e.onError(t),e._reconnect()})},n)}},c.prototype.request=function(e,t){\"string\"==typeof e&&(e={method:\"GET\",path:e});var n={type:\"request\",method:e.method||\"GET\",path:e.path,headers:e.headers,payload:e.payload};return this._send(n,!0,t)},c.prototype.message=function(e,t){var n={type:\"message\",message:e};return this._send(n,!0,t)},c.prototype._send=function(e,n,r){var u=this;return r=r||t,this._ws&&this._ws.readyState===c.WebSocket.OPEN?(e.id=++this._ids,void o(e,function(t,o){if(t)return i(r)(t);if(!n)try{return u._ws.send(o)}catch(e){return i(r)(new s(e,\"ws\"))}var c={callback:r,timeout:null};u._settings.timeout&&(c.timeout=setTimeout(function(){return c.callback=null,c.timeout=null,r(new s(\"Request timed out\",\"timeout\"))},u._settings.timeout)),u._requests[e.id]=c;try{u._ws.send(o)}catch(t){return clearTimeout(u._requests[e.id].timeout),delete u._requests[e.id],i(r)(new s(t,\"ws\"))}})):i(r)(new s(\"Failed to send message - server disconnected\",\"disconnect\"))},c.prototype._hello=function(t,n){var o={type:\"hello\",version:e};t&&(o.auth=t);var i=this.subscriptions();return i.length&&(o.subs=i),this._send(o,!0,n)},c.prototype.subscriptions=function(){return Object.keys(this._subscriptions)},c.prototype.subscribe=function(e,t,n){var o=this;if(!e||\"/\"!==e[0])return i(n)(new s(\"Invalid path\",\"user\"));var r=this._subscriptions[e];if(r)return r.indexOf(t)===-1&&r.push(t),i(n)();if(this._subscriptions[e]=[t],!this._ws||this._ws.readyState!==c.WebSocket.OPEN)return i(n)();var u={type:\"sub\",path:e};return this._send(u,!0,function(t){return t&&delete o._subscriptions[e],n(t)})},c.prototype.unsubscribe=function(e,t,n){if(!e||\"/\"!==e[0])return i(n)(new s(\"Invalid path\",\"user\"));var o=this._subscriptions[e];if(!o)return i(n)();var r=!1;if(t){var u=o.indexOf(t);if(u===-1)return i(n)();o.splice(u,1),o.length||(delete this._subscriptions[e],r=!0)}else delete this._subscriptions[e],r=!0;if(!r||!this._ws||this._ws.readyState!==c.WebSocket.OPEN)return i(n)();var a={type:\"unsub\",path:e};return this._send(a,!0,function(e){return n()})},c.prototype._onMessage=function(e){var t=this;this._beat();var o=e.data,i=o[0];if(\"{\"!==i){if(this._packets.push(o.slice(1)),\"!\"!==i)return;o=this._packets.join(\"\"),this._packets=[]}this._packets.length&&(this._packets=[],this.onError(new s(\"Received an incomplete message\",\"protocol\"))),n(o,function(e,n){if(e)return t.onError(e);var o=null;if(n.statusCode&&n.statusCode>=400&&n.statusCode<=599&&(o=new s(n.payload.message||n.payload.error,\"server\"),o.statusCode=n.statusCode,o.data=n.payload,o.headers=n.headers,o.path=n.path),\"ping\"===n.type)return t._send({type:\"ping\"},!1);if(\"update\"===n.type)return t.onUpdate(n.message);if(\"pub\"!==n.type&&\"revoke\"!==n.type){var i=t._requests[n.id];if(!i)return t.onError(new s(\"Received response for unknown request\",\"protocol\"));var r=i.callback;if(clearTimeout(i.timeout),delete t._requests[n.id],r)return\"request\"===n.type?r(o,n.payload,n.statusCode,n.headers):\"message\"===n.type?r(o,n.message):\"hello\"===n.type?(t.id=n.socket,n.heartbeat&&(t._heartbeatTimeout=n.heartbeat.interval+n.heartbeat.timeout,t._beat()),r(o)):\"sub\"===n.type||\"unsub\"===n.type?r(o):t.onError(new s(\"Received unknown response type: \"+n.type,\"protocol\"))}else{var c=t._subscriptions[n.path];if(\"revoke\"===n.type&&delete t._subscriptions[n.path],c&&void 0!==n.message){var u={};\"revoke\"===n.type&&(u.revoked=!0);for(var a=0;a<c.length;++a)c[a](n.message,u)}}})},c.prototype._beat=function(){var e=this;this._heartbeatTimeout&&(clearTimeout(this._heartbeat),this._heartbeat=setTimeout(function(){e.onError(new s(\"Disconnecting due to heartbeat timeout\",\"timeout\")),e._ws.close()},this._heartbeatTimeout))},{Client:c}})}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}]},{},[1]);"],"file":"main.min.js","sourceRoot":"/source/"}